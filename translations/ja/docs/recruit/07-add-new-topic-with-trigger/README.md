<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "c04b3587170139bc23e3b5cfc24c89ac",
  "translation_date": "2025-10-18T02:48:08+00:00",
  "source_file": "docs/recruit/07-add-new-topic-with-trigger/README.md",
  "language_code": "ja"
}
-->
# 🚨 ミッション07: トリガーとノードを使った新しいトピックの追加

## 🕵️‍♂️ コードネーム: `OPERATION STAY ON TOPIC`

> **⏱️ 作業時間:** `約60分`

🎥 **ウォークスルーを見る**

[![トリガー動画サムネイル](../../../../../translated_images/video-thumbnail.a84cf7cb473be282861469420c5e2c16adb53bcfd64c7c07fbd579e8d32bf8b2.ja.jpg)](https://www.youtube.com/watch?v=7iPAZaA8nJs "YouTubeでウォークスルーを見る")

## 🎯 ミッション概要

あなたはエージェントを構築しました。エージェントは聞き、学び、質問に答えます。しかし、今度はより戦略的に進める時です。このミッションでは、エージェントが特定のプロンプトに正確に応答する方法を学びます。

トピックとトリガーを使用することで、エージェントは以下のことが可能になります:

- 意図を認識する
- 論理的に会話をルーティングする
- 変数を収集し保存する
- フローをトリガーしてアクションを実行する

単なる対話を構築するだけでなく、意思決定の中枢を配線することになります。ようこそ、ニューロンネクサスへ。

## 🔎 目標

このミッションでは以下を学びます:

1. トピックとは何か、エージェントの構造化された会話を作成する上での役割を理解する
1. トリガーフレーズや会話ノードを含むトピックの構造を学ぶ
1. 様々な種類の会話ノードを探求し、動的なロジックにPower Fxを使用する方法を学ぶ
1. 特定のユーザーリクエストやタスクを処理するためのカスタムトピックをゼロから作成する
1. コネクタやツールを使用してSharePointデータに接続する機能的なトピックを構築する

## 🤔 トピックとは？

トピックとは、エージェントが特定のユーザーの質問やタスクに応答するための構造化された会話です。トピックは、エージェントが処理できるミニ会話やタスクと考えることができます。各トピックは、特定のユーザーの質問やリクエストに応答するように設計されています。

### 🌌 トピックの目的

ユーザーのニーズに基づいて、トピックには以下の3つの一般的な目的があります:

**情報提供** - 以下のような質問に答える:

- `...とは何ですか？`
- `...はいつですか？`
- `なぜ...ですか？`
- `...について教えてください。`

**タスクの完了** - ユーザーが何かをするのを助ける:

- `"...したい"`
- `"どうやって...するの？"`
- `"...が必要です"`

**トラブルシューティング** - 問題を解決する:

- `何かがうまくいかない...`
- `エラーメッセージが表示される...`
- `予期しないことが起きている...？`

また、`助けが必要です`のような曖昧な質問に対して、詳細を尋ねるトピックを作成することもできます。

## 🐦 トピックが役立つ理由

トピックは以下のことに役立ちます:

- エージェントの知識を整理する。
- 会話を自然に感じさせる。
- ユーザーの問題を効果的に解決する。

## 🪺 トピックの種類

1. **システムトピック** - これらは組み込みで、以下のような一般的なイベントを処理します:
    - 会話の開始
    - 会話の終了
    - エラーの処理
    - ユーザーにサインインを求める
    - 人間のエージェントへのエスカレーション

1. **カスタムトピック** - 特定のタスクや質問を処理するために作成するもの:
    - 従業員の休暇申請
    - 新しいデバイスまたは交換デバイスのリクエスト

![トピックの種類](../../../../../translated_images/7.0_01_Topics.6e55d2e01c1cc0994b7af05be3c1629b78d46b37cc82f59c7893d4ad90af707e.ja.png)

## 🧬 トピックの構造

各トピックには通常以下が含まれます。

### 🗣️ トリガーフレーズ

トピックを開始するためにユーザーが言う可能性のある言葉や文です。

**例:**

休暇申請トピックの場合、トリガーフレーズは以下のようなものがあります:

- `休暇を取りたい`
- `休暇を申請する`
- `休暇を申請する方法は？`

デバイスリクエストトピックの場合、トリガーフレーズは以下のようなものがあります:

- `新しいデバイスが必要です`
- `デバイスをリクエストできますか？`
- `デバイスリクエストを手伝ってくれますか？`

### 💬 会話ノード

トピックはノードで構成されており、トピックがトリガーされた後にエージェントが従うステップです。これらのステップを接続して、ユーザーとの対話時にエージェントが従う会話フローを構築します。

これらは以下のような指示やアクションと考えることができます:

- ユーザーに質問する
- メッセージを送信する
- 休暇管理システムなどの外部サービスを呼び出す
- 変数を設定または確認する
- 条件を使用して会話を分岐させる
- 別のトピックに誘導する

![会話ノード](../../../../../translated_images/7.0_03_ConversationNodes.7b1d93b7d4522d544d7f9eed597a5ef30b9f96ee1670efd048528ce13423481a.ja.png)

以下はエージェントに追加できる主なノードの種類です:

#### メッセージを送信

- **目的** - ユーザーにメッセージを送信する。
- **例** - `リクエストありがとうございます！お手伝いします。`

このノードは、エージェントがユーザーにメッセージを送信できるようにします。メッセージは単純なテキストや画像、動画、カード、クイック返信、アダプティブカードなどのリッチコンテンツを含むことができます。

変数を使用してメッセージを個別化したり、バリエーションを追加して変化を持たせたり、音声対応チャンネル用に音声出力をカスタマイズすることも可能です。

!!! tip
    エージェントがユーザーと明確かつインタラクティブにコミュニケーションを取るための「何かを言う」ブロックと考えてください。

#### 質問をする

- **目的** - ユーザーに質問をし、回答を待つ。
- **例** - `休暇の日程はいつですか？`

このノードは、会話中にユーザーから特定の情報を尋ね、その回答を後で使用するために変数に保存するために使用されます。

質問の種類をテキスト入力にカスタマイズしたり、ユーザーが選択する値の定義済みリストを持つエンティティを使用したり、ユーザーが無効な回答をした場合や質問をスキップした場合のエージェントの動作を定義することができます。

また、画像やクイック返信などのリッチコンテンツをサポートし、会話がスムーズに進むように検証、再プロンプト、割り込み設定を微調整することができます。

!!! tip
    エージェントがユーザーと構造化された方法で対話するための「質問して聞く」ブロックと考えてください。

#### アダプティブカードで質問

- **目的** - JSONを使用してリッチでインタラクティブなカードを送信する。
- **例** - ユーザーが日付を選択するためのカレンダー日付ピッカーを表示するカード。

このノードは、ユーザーが記入して送信できるリッチでインタラクティブなカードを表示します。例えば、テキストボックス、ボタン、画像を含むフォームなどです。ユーザーの入力をキャプチャし、それを変数に保存して、会話の後でエージェントが使用できるようにします。

!!! tip
    エージェントがユーザーから詳細な情報を収集するためのカスタマイズ可能な「フォーム作成」ブロックと考えてください。

#### 条件を追加

- **目的** - 会話にロジックを追加する。何かをチェックして次に何をするかを決定する。
- **例** - ユーザーが`はい`と言った場合、次のステップに進む。`いいえ`の場合、会話を終了する。

このノードは、変数が特定の条件を満たしているかどうかをチェックすることで、エージェントの会話フローに意思決定ポイントを作成します。条件が真か偽かに基づいて、エージェントは異なるパスをたどります。

!!! tip
    エージェントがユーザー入力や変数に基づいて意思決定を行うための「if-else」ブロックと考えてください。

#### 変数管理

- **目的** - 会話中に情報（変数と呼ばれる）を保存またはクリアする。
- **例** - アダプティブカードを表示する質問ノードでユーザーが選択した日付を保存する。

このノードは、会話中に情報を保存および管理することができます。例えば、ユーザーの名前、回答、または好みなどです。テキスト、数字、日付などの異なる種類の変数を使用でき、単一のトピックに限定されたもの、トピック間で共有されるもの（グローバル）、またはシステムや環境から取得されるものがあります。

!!! tip
    エージェントが情報を記憶し、会話が進むにつれてそれを使用するための「記憶ボックス」と考えてください。

#### トピック管理

- **目的** - 会話を別のトピックやトピック内のステップに移動させる、会話を転送する、またはトピックや会話を終了する。
- **例** - "休暇ポリシー"トピックにリダイレクトする。

このノードは、エージェントが会話を再開せずに1つのトピックから別のトピックにジャンプしたり、トピックを終了したり、会話を転送または終了したり、同じトピック内の異なるステップに進んだりすることを可能にします。トピック間をスムーズに移行しながら、変数を渡してコンテキストを維持することができます。

!!! tip
    エージェントが柔軟にユーザーと会話するための「別のセクション/ステップに移動」ブロックと考えてください。

#### ツールを追加

- **目的** - コネクタ、エージェントフロー、プロンプト、カスタム検索、検索クエリ、スキル、モデルコンテキストプロトコルなどのツールに接続する。
- **例** - ユーザーが休暇申請を提出した後にエージェントフローを実行する。

このノードは、エージェントが外部システムとやり取りしたり、特定のタスクを実行したりする能力を提供します。例えば、メールを送信したり、天気を確認したり、データベースにアクセスしたりすることができます。組み込みコネクタ、カスタムAPI、エージェントフロー、プロンプト、またはモデルコンテキストプロトコル（MCP）サーバーに接続することができ、デスクトップアプリのGUI自動化を可能にするコンピュータ使用ツールも利用できます。

!!! tip
    エージェントがチャットを超えて、APIを呼び出したり、プロセスを実行したり、ユーザー入力を自動的に収集したりする「アクションブロック」と考えてください。

#### 生成回答ノード

- **目的** - 大規模言語モデルを使用して、ユーザーの質問と接続されたデータに基づいて自然で人間らしい応答を生成する。
- **例** - 休暇申請に関する情報を含む接続された知識ソースを使用して、ユーザーの休暇リクエストに関する質問に回答する。

このノードは、ウェブサイト、ドキュメント、SharePoint、またはカスタムデータなどの様々な知識ソースからの情報を使用して、ユーザーの質問に応答する能力をエージェントに提供します。トピックが見つからない場合のフォールバックとして使用することも、トピック内で特定のソースに基づいて詳細で動的な回答を提供するために使用することもできます。

!!! tip
    エージェントが定義した信頼できるコンテンツを検索して役立つ正確な回答を提供する「スマート回答ブロック」と考えてください。

#### HTTPリクエストノード

- **目的** - API呼び出し（例えば`GET`や`POST`）を送信してデータを取得または更新することで、エージェントを外部システムに接続する。
- **例** - ユーザーが休暇日数の残高を尋ねた場合、エージェントが休暇管理システムに`GET`リクエストを送信し、API応答から`remainingLeaveDays`を抽出してその値をユーザーに返信する。

このノードは、エージェントが`GET`や`POST`リクエストなどのREST API呼び出しを送信することで外部システムに接続することを可能にします。ヘッダー、本文の内容をカスタマイズしたり、Power Fxを使用して動的データを含めたりすることができ、応答を変数に保存して会話の後で使用することができます。

!!! tip
    エージェントが他のサービスとやり取りするための「情報を取得する」ブロックと考えてください。例えば、ユーザーの詳細を取得したり、別のシステムにデータを送信したりすることができます。

#### イベントを送信

- **目的** - クライアントやチャンネルにシステム更新やツールトリガーなどの非メッセージアクションを送信し、タスクを実行する。
- **例** - ユーザーがチャットに参加した際にウェルカムメッセージを表示する。

このノードは、エージェントが外部システムやチャンネルに非メッセージアクションを送信できるようにします。これにより、外部システムがどのように応答するかを決定できます。各イベントに名前を付け、値を添付します。値は単純な数字やテキスト、変数、またはPower Fxの式であり、JSONオブジェクトとして送信されます。

!!! tip
    エージェントが舞台裏で何かを行ったり、ユーザーが何も言わなくても外部ツールと通信したりする「サイレントトリガー」ブロックと考えてください。

## 🏋🏻‍♀️ ノードでのPower Fxの使用

Copilot Studioでは、Power Fxはエージェントにロジックや動的な動作を追加するために使用されるローコードプログラミング言語です。Microsoft Power Appsで使用される言語と同じで、シンプルでExcelのような使い心地を持ち、開発者だけでなく非開発者にも使いやすい設計になっています。

![Power Fx式](../../../../../translated_images/7.3_13_EnterFormula.d17cc9f73e01e1cab8e2420a55bcb726ae0a0e55673f81ee3d7fe12d20148b92.ja.png)

### トピックでのPower Fxの活用方法

- 変数の設定と操作
      - 例: `Set(userName, "Adele Vance")`
- 条件の作成
      - 例: `If(score > 80, "合格", "不合格")`
- データのフォーマットと変換
      - 例: `Text(DateValue, "dd/mm/yyyy")`

### Power Fxを使用する理由

- **柔軟性:** フルコードを書かずにロジックを構築できる。
- **親しみやすさ:** Excelの数式を使ったことがあれば、非常に似ている。
- **強力:** 会話を個別化し、入力を検証し、ユーザーデータに基づいてエージェントの
これにより、自然言語を使用して希望する内容を記述することができ、Copilotが会話を構築してくれます。同様に、トピックを編集する際も自然言語を使用すると、Copilotがトピックをレビューして修正してくれます。

#### Copilotがサポートする内容

- 作成および編集可能:
      - メッセージノード
      - 質問ノード
      - 条件ノード
- 高度な設定（例: ユーザーが応答しない場合の再プロンプト方法や質問中の中断管理方法など）はサポートしていません。ただし、必要に応じて手動でこれらの設定を調整することは可能です。

#### なぜこれが役立つのか

- AIの支援により開発が迅速化します。
- 繰り返しの設定ではなく、ロジックやユーザー体験に集中できます。
- 最小限の労力で会話フローを繰り返し改善することができます。

#### ✨ 例のプロンプト

- **トピックを作成する**
      - `ユーザーの名前、年齢、生年月日を受け取り、それらの回答を繰り返す`
      - `ユーザーの住所、州、郵便番号を収集する。各質問に対して最大4回まで再試行できるようにする`

- **トピックを編集する**
      - `ユーザーの生年月日を尋ねる質問を追加する`
      - `収集した情報をAdaptive Cardで要約する`

## 👩🏻‍🎨 OK、エージェントのトピックをどのように設計するの？

### 🧙🏻‍♂️ ステップ1 - ユーザーのニーズを理解する

まず、エージェントにユーザーが尋ねる一般的な質問やタスクを特定します。これには以下が含まれる可能性があります:

- ユーザーがよく尋ねる質問、例: `病欠日数の権利はどれくらいですか？`
- ユーザーが完了したい一般的なタスク、例: フォームの提出
- ユーザーがよく直面する問題、例: ログインの問題

### 📦 ステップ2 - シナリオをグループ化する

ユーザーのニーズを、以前学んだトピックの目的に基づいて3つのカテゴリに整理します:

- 情報提供 - ユーザーが何かを知りたい
- タスク完了 - ユーザーが何かをしたい
- トラブルシューティング - ユーザーが問題解決の支援を必要としている

### 🗺️ ステップ3 - 会話をマッピングする

エージェントがどのように応答すべきかの簡単な会話フローをスケッチします。

- 挨拶や確認から始める
- 詳細を得るためのフォローアップ質問をする
- 回答を提供するか、アクションを実行する

!!! tip
    会話を短く、焦点を絞ったものにしましょう。必要なことだけを尋ねるようにします。

### 🔀 ステップ4 - 異なる会話タイプに対応する

以下の両方に対応する設計を行います:

- **単一ターン** - 1つの質問、1つの回答

- **複数ターン** - フォローアップ質問を含むやり取り

例:

- ユーザー: `休暇申請をしたいです。`

- エージェント: `承知しました！休暇開始日はいつですか？`

- ユーザー: `7月15日です。`

- エージェント: `了解しました。休暇終了日はいつですか？`

- ユーザー: `7月22日です。`

- エージェント: `ありがとうございます！休暇の理由は何ですか？`

- ユーザー: `家族旅行です。`

- エージェント: `詳細ありがとうございます。7月15日から7月22日までの家族旅行の休暇申請を提出しました。すぐに確認が届きます。`

### 🤖 ステップ5 - 想定外の質問にAIを活用する

たとえ休暇申請のトピックを設計していても、ユーザーが直接カバーされていない質問をする可能性があります。この場合、AI機能である_Conversational boosting_システムトピックが役立ちます。

このトピックには生成回答ノードが含まれており、エージェントが接続された知識ソースをすぐに使用できるようになります。エージェントレベルで追加された知識ソースは、_Conversational boosting_システムトピック内の生成回答ノードに自動的に含まれます。

#### 例

- ユーザー: `未使用の休暇日数を翌年に繰り越すことはできますか？`

この質問は、特にトピックが休暇申請の提出のみを扱っている場合、事前定義されたトピックフローの一部ではないかもしれません。

#### AIの助け

エージェントが会社の人事ポリシー文書や内部ウェブサイトに接続されている場合、AIは以下を行うことができます:

- 関連する休暇ポリシーを検索
- 規則を理解し要約
- エージェントが応答: `人事ポリシーによると、未使用の休暇日数を次の暦年に繰り越すことができます。詳細については、HRポータルの休暇ポリシーセクションをご確認ください。`

#### なぜこれが役立つのか

- ポリシー関連の質問ごとにトピックを手動で作成する必要がありません。
- AIが信頼できる知識ソースから正確な回答を引き出すことができます。
- エージェントがより賢く、応答性が高いと感じさせることで、ユーザー体験が向上します。

### 🔬 ステップ6 - トピックと会話フローをテストする

トピックを公開する前に:

- 実際の質問やサンプル入力を使用してテストを行う。
- 自然で役立つ内容になっているか確認する。

!!! tip
    テストに基づいてトピックを改善する。必要に応じてノードを追加したり、他のトピックにリダイレクトするためにノードを削除したりする。

### ⚠️ ステップ7 - ウェブサイトのコンテンツを重複させない

すでにウェブサイトにある内容をコピーしないでください。

- ユーザーがよく尋ねるトピックに焦点を当てる。
- チャット履歴やサポートリクエストに基づいて新しいトピックを追加する。

### ✨ 会話フローの例

以下は休暇申請を扱うトピックの例です。

#### ステップ1: トリガーフレーズ

ユーザーが入力します、

`休暇申請をしたいです`

#### ステップ2: Adaptive Cardを使用して詳細を尋ねる

エージェントが尋ねます、

`承知しました！どの日付をお休みにしたいですか？`

Adaptive Cardには開始日と終了日のカレンダーピッカーコントロールがあります。

#### ステップ3: ユーザーが日付を提供する

ユーザーが開始日を2025年8月5日、終了日を2025年8月10日としてカードを送信します。日付の値はAdaptive Cardの出力として変数に保存されます。

#### ステップ4: クラウドフローの実行

Power Automateのクラウドフローが実行され、休暇管理システムに新しいリクエストが作成され、休暇申請を通知するメールがマネージャーに送信されます。

#### ステップ5: ユーザーに確認メッセージを送信する

エージェントが応答します、

`2025年8月5日から8月10日までの休暇申請を提出しました。マネージャーが確認し、すぐに返信があります。`

## 🧪 ラボ07 - 会話ノードを含む新しいトピックを追加する

次に、トリガーとツールを使用して新しいトピックを追加する方法を学びます。このラボでは、空白からトピックを作成する方法をカバーし、ニーズに合わせてトピックをカスタマイズする方法を理解します。

- [7.1 空白から新しいトピックを追加する](../../../../../docs/recruit/07-add-new-topic-with-trigger)
- [7.2 トリガーの入力と出力を定義する](../../../../../docs/recruit/07-add-new-topic-with-trigger)
- [7.3 コネクタを使用してツールを追加する](../../../../../docs/recruit/07-add-new-topic-with-trigger)

### ✨ ユースケース

**役割**: 従業員

**目的**: 利用可能なデバイスを知りたい

**理由**: 利用可能なデバイスのリストを取得するため

では始めましょう！

### 前提条件

1. **SharePointリスト**

    [Lesson 00 - コースセットアップ - ステップ3: 新しいSharePointサイトを作成する](../00-course-setup/README.md#step-4-create-new-sharepoint-site)で作成した**Devices** SharePointリストを使用します。

    **Devices** SharePointリストをまだ設定していない場合は、[Lesson 00 - コースセットアップ - ステップ3: 新しいSharePointサイトを作成する](../00-course-setup/README.md#step-4-create-new-sharepoint-site)に戻ってください。

1. **Contoso Helpdesk Agent**

    [Lesson 06 - Copilotを使用して自然言語でカスタムエージェントを作成し、データで基盤を構築する](../06-create-agent-from-conversation/README.md)で以前作成したエージェントを使用します。

### 7.1 空白から新しいトピックを追加する

1. エージェント名の近くにある**Topicsタブ**を選択します。表示されていない場合は**+6**を選択すると**Topics**が表示されます。

    ![Topicsを選択](../../../../../translated_images/7.1_01_Topics.789ffa4f75830b5f25fb1eeb8fa3e8ba3810b95870cb3dc49d80d8f4ba15a00a.ja.png)

1. **Topics**タブが読み込まれ、デフォルトで_Custom_トピックが表示されます。トピックをAll、Custom、Systemでフィルタリングできます。現在表示されているカスタムおよびシステムトピックは、エージェントがプロビジョニングされた際に自動的に作成されたものです。

    **+ Add a topic**を選択し、**From blank**を選択します。

    ![ゼロからトピックを作成](../../../../../translated_images/7.1_02_FromBlank.f3fe83fad24825f8eb498b19af8e472810f657868613b96b3b4e033fa1042e75.ja.png)

1. トピックの名前を入力します。以下をコピーして貼り付けてください。

    ```text
    Available devices
    ```

    ![トピックに名前を付ける](../../../../../translated_images/7.1_03_TopicName.06eb34ebe94516c1d898b5dff183f9586f7526f9316bc122dca641ac29967966.ja.png)

1. トピックが何をするかを説明するトリガーの説明を入力します。以下をコピーして貼り付けてください。

    ```text
    This topic helps users find devices that are available from our SharePoint Devices list. User can ask to see available devices and it will return a list of devices that are available which can include laptops, smartphones, accessories and more.
    ```

    ![トリガーの名前と説明を入力](../../../../../translated_images/7.1_04_TriggerDescription.cb748c0358b3af249fcc0fdb0b262185ffed14d8cf628186b8a65ad4bbf14172.ja.png)

### 7.2 トリガーの入力と出力を定義する

1. 次に、生成AIがオーケストレーションでユーザーのメッセージからデバイスタイプの値を抽出するために使用する新しい入力変数を追加します。トピックの**More ellipsis (...)**を選択し、**Details**を選択してトピック詳細ペインを表示します。

    ![トピック詳細を選択](../../../../../translated_images/7.2_01_SelectTopicDetails.cc1b97a86718e101084c366514cc306fe82243a014a44c579394e0f70ba5ca53.ja.png)

1. **Topic details**ペインが読み込まれました。**Input**タブを選択します。

    ![Inputタブ](../../../../../translated_images/7.2_02_SelectInputTab.d0b900eb02a8f982324f59e3b7aca34c2cdba78263acdc9301225e1c3e6338b6.ja.png)

1. **Create a new variable**を選択します。

    ![新しい入力変数を作成](../../../../../translated_images/7.2_03_CreateANewVariable.0d45780268d9b6250617c45a9ddd557cdaa23945b66539b313ca8d74f2c96cc2.ja.png)

1. 変数の名前を入力します。以下をコピーして貼り付けてください。

    ```text
    VarDeviceType
    ```

    ![入力変数名](../../../../../translated_images/7.2_04_VariableName.56555922eab13cad52fa29d846f4e515d82c2e9bf61c86705f080a1ba4f3b1af.ja.png)

1. 次に、トピックの入力と出力変数を定義する必要があります。以下は、トピックの入力と出力に定義できるプロパティです。

    | フィールド    | 値 |
    | ---------- | :--------- |
    | エージェントがこの入力をどのように埋めるか | エージェントがトピックを実行する前にこの変数を値で埋める方法を決定します。デフォルトでは_Dynamically fill with the best option_に設定されています。それ以外の場合、ユーザーに尋ねる代わりに値で入力を上書きすることができます|
    | 変数データ型  | 変数のデータ型。サポートされているデータ型は`String`、`Boolean`、`Number`、`Date`、`DateTime`、`DateTimeNoTimeZone`、`Time`、`Record`、`Table`、`Unspecified`、`From sample data` |
    | 表示名   | 変数の名前   |
    | 識別方法  | エージェントが正しい値タイプを取得するためのエンティティタイプ  |
    | 説明    | 説明は、エージェントがトピックを実行する前に入力を自動的に埋めるのを助けたり、値を尋ねる質問を生成するのに役立ちます   |

    _エージェントがこの入力をどのように埋めるか_、_変数データ型_、_表示名_はそのままにしておきます。**Identify as**プロパティを**User's entire response**に更新します。

    ![Identify asを更新](../../../../../translated_images/7.2_05_IdentifyAs.a502101e6f60c27ed8c8b1eff049b8ceedd0531845b932f9b7608ad3d8220090.ja.png)

1. 以下を説明としてコピーして貼り付けてください。

    ```text
    List of possible values: Laptop, Desktop, Smartphone
    ```

    ![説明](../../../../../translated_images/7.2_06_InputDescription.844e1776080e595c6c221bcc33d7a269abcc7e4755c8f11b284c3950f42166b5.ja.png)

1. 次に、トピックの出力を定義します。**Output**タブを選択します。

    ![Outputタブを選択](../../../../../translated_images/7.2_07_SelectOutputTab.ab5aa0a2f385f1492df5a67f8f2cbed752dc0258c1e1ddb9928d204405ec403a.ja.png)

1. **Create a new variable**を選択します。

    ![新しい出力変数を作成](../../../../../translated_images/7.2_08_CreateANewVariable.5518205f121014ff4757af062bedfd38ce768c8f38291dd9d6489d67cd5d5dc8.ja.png)

1. 以下のプロパティを更新します。

    **変数名** - 以下をコピーして貼り付けてください。

    ```text
    VarAvailableDevices
    ```

    **変数データ型** - データ型として**Table**を選択します。

    **変数の説明** - 以下をコピーして貼り付けてください。

    ```text
    List of available devices by device type
    ```

    ![出力プロパティ](../../../../../translated_images/7.2_09_OutputVariable.fb0e159fbad5052280040090352c50faf4d91228095c3762e75440b2842e0d29.ja.png)

1. トピックの入力と出力の定義が完了しました。**Xアイコン**を選択して**Topic details**ペインを終了します。

    ![トピック詳細ペインを終了](../../../../../translated_images/7.2_10_ExitTopicDetailsPane.6e8981434f04049bef7ab93f9545ee433087e1c99cdfe27b355ee9858ddfde99.ja.png)

### 7.3 コネクタを使用してツールを追加する

1. 次に、エージェントが**Devices** SharePointリストからデバイスのリストを取得できるノードを追加します。トリガーの下にある**+アイコン**を選択します。

    ![ツールを追加](../../../../../translated_images/7.3_01_AddNode.4656328835f7a28bc5f66c440d620a0990bf098e858619ff2c32a9b14fae7c4f.ja.png)

1. **Add a tool**ノードを選択し、**Connector**タブを選択します。`Get items`を検索し、**Get items** SharePointコネクタアクションを選択します。

    ![Get itemsを選択](../../../../../translated_images/7.3_02_GetItems.a6bdfb122449de789e7c58592f4c3e3a0f38b7bdcec2e0e5eab34b2d9d991f97.ja.png)

1. コネクタの新しい接続を作成する必要があります。**chevron**アイコンを選択し、**Create new connection**を選択します。

    ![ツールを追加](../../../../../translated_images/7.3_03_CreateNewConnection.03f49fab97e5f5f2a298e4b1b2e5081304c9c98c5f3ad5be0302c241c3d83d94.ja.png)

1. SharePoint Onlineに直接接続するか、オンプレミスのSharePointに接続するかを選択する2つのオプションが表示されます。デフォルトで**Connect directly (cloud-services)**オプションが選択されており、これを接続に使用します。
**作成**を選択します。

![作成を選択](../../../../../translated_images/7.3_04_SelectCreate.f2216f1e276ed153e06d5b5d47f170a0f9cc6854aa05f0736623acb3aeee1229.ja.png)

1. サインインしているユーザーアカウントを選択します。

   ![サインインしているユーザーアカウントを選択](../../../../../translated_images/7.3_05_SelectSignedInUserAccount.e27a0ada918a1cf4477f3966adcc5f1d033a8998a2589d02d1208f21f5d93938.ja.png)

1. 次に、SharePointコネクタへの接続にユーザーアカウントを使用できることを確認する必要があります。**アクセスを許可**を選択します。

   ![アクセスを許可を選択](../../../../../translated_images/7.3_06_AllowAccess.69f012dbcedf7ebc1869e648a5eaa661d085b15aa7a2eb69e69c5b63adfa36dd.ja.png)

1. **Get items** SharePointコネクタアクションをトピックにノードとして追加するために**送信**を選択します。

   ![送信](../../../../../translated_images/7.3_07_ConnectedSelectSubmit.16ec31ef062696cabb6e7964879debd177f2b9162f88ef95ae1b4eed85e08a21.ja.png)

1. **Get items** SharePointコネクタアクションがトピックに追加されました。これでアクションの入力を設定する準備が整いました。**省略記号 (...) アイコン**を選択し、**プロパティ**を選択します。

   ![プロパティを選択](../../../../../translated_images/7.3_08_GetItemsProperties.32bdda34a1d73a55eb2893695e4b4cf15cd899806e616d0b0b5015471414c9d7.ja.png)

1. **Get items**の設定ペインが表示され、デフォルトで**入力**タブが表示されます。**開始**タブを選択し、**使用説明**フィールドに説明を入力します。以下をコピーして貼り付けてください。

    ```text
    Retrieves devices from SharePoint list
    ```

   > これは、エージェントの_接続を管理する_ページを表示する際に役立ちます。すぐに戻ってきます。

   ![Get itemsの説明](../../../../../translated_images/7.3_09_UpdateDescription.76a8d2ebddd4c3e4ca423daad7485afa60f31f37c97e16529d94e224f9709d60.ja.png)

1. **入力**タブを選択し、[Lesson 00 - コースセットアップ - ステップ3: 新しいSharePointサイトを作成](../00-course-setup/README.md#step-4-create-new-sharepoint-site)で設定した**Contoso IT**サイトと**Devices**リストを選択します。

   ![Get itemsの入力を設定](../../../../../translated_images/7.3_10_GetItemsInputs.17f8689e660c480dd405ab2ab57db34dcd2b8e697ec09d54c8f8649eb619c58b.ja.png)

1. 次に、SharePointリストから以下の条件に基づいてデバイスのみを表示するようにします。
   - 選択された値
   - ステータスが_Available_であるデバイスのみ

   フィルターを適用する必要があります。これは、Power Fxを使用してフィルタークエリを入力することで実現します。**省略記号 (...) アイコン**を選択します。

   ![省略記号アイコンを選択](../../../../../translated_images/7.3_11_SelectVariable.33bfe876cc230569ea0f6cc5e1efa100432509e44342e9b3d6a9e65ee2bc525f.ja.png)

1. デフォルトでは**カスタム**タブにいます。**数式**タブを選択します。

   ![数式タブを選択](../../../../../translated_images/7.3_12_SelectFormula.a7aba25c95956d113865da3f30da3f3872e12c7a7a8f3c65098a3e3fac9616a4.ja.png)

1. **展開**アイコンを選択して**数式**フィールドを拡大します。以下のPower Fx式をコピーして貼り付けてください。

   `Concatenate`関数を使用して、以下の条件をフィルターする式を作成します。
   - SharePoint列の**Status**が_Available_である
   - SharePoint列の**Asset type**が_質問ノードで選択されたデバイス_である

    ```text
    Concatenate("Status eq 'Available' and AssetType eq '", Topic.VarDeviceType, "'")
    ```

   **挿入**を選択します。

   ![Power Fx式を入力して挿入を選択](../../../../../translated_images/7.3_13_EnterFormula.d17cc9f73e01e1cab8e2420a55bcb726ae0a0e55673f81ee3d7fe12d20148b92.ja.png)

1. Power Fx式が**Get items**アクションのフィルタークエリ入力パラメータに適用されます。次に、**Limit Columns by View**で**All items**ビューを選択します。これにより、選択されたビューに基づいてリスト内の列のみが取得されます。

   ![ビューによる列の制限](../../../../../translated_images/7.3_14_LimitColumnsByView.5537126aaa087bd7f81cc35dfe182aa72cdbec4fe1fb5c2e15823a1275dcaa71.ja.png)

1. 次に、出力の変数名を更新します。**出力**タブを選択し、`GetItems`変数を選択します。

   ![変数を更新](../../../../../translated_images/7.3_15_ConfigureOutputs.d4cb0c5c8e37d1859ed705bd1582fce2d063e7f4d65cc036127a846d743ff391.ja.png)

1. 以下の名前に更新します。

    ```text
    VarDevices
    ```

   ![変数名を更新](../../../../../translated_images/7.3_16_RenameVariable.55d7adb355808d39fe515bf980af123c60e218fa427354079e86efc412dc0f83.ja.png)

1. 下にスクロールし、**使用**セクションで**グローバル**を選択します。これにより、変数が任意のトピックでアクセス可能になります。

   ![グローバル変数に更新](../../../../../translated_images/7.3_17_UpdateToGlobalVariable.09bdb05c0938898a04e48b6bcebee1584f17080b63b2577594be74f9f77a5bc3.ja.png)

1. **変数プロパティ**ペインを**閉じる**を選択します。

   ![変数プロパティペインを閉じる](../../../../../translated_images/7.3_18_ExitVariablePropertiesPane.b1a5e76dfe490bdf1274d8e8c78df44f9b3e3542180fa52fb6f903a980ef31ab.ja.png)

1. **プラス +** アイコンを選択して新しいノードを挿入し、**変数管理**を選択して**変数値を設定**を選択します。

   ![変数値を設定ノードを追加](../../../../../translated_images/7.3_19_AddSetAVariableValueNode.958d21c21727ef92506fe76cf0458f05ac8508d84d0a4917077d2889410330e2.ja.png)

1. **Set variable**入力パラメータの**大なり記号**アイコンを選択します。

   ![変数を設定](../../../../../translated_images/7.3_20_SelectAVariable.9d3beb144002569b947c90cbec22afcc9cb34f277b21e3f65dcaf69831abc438.ja.png)

1. 先ほど作成したトピック出力を変数として選択し、**VarAvailableDevices**を選択します。

   ![トピックを保存](../../../../../translated_images/7.3_21_SelectVarAvailableDevicesOutput.8d7259eb6ce1bc7c89de10b768b62dc3008ad7468c094249282bfe66436d1672.ja.png)

1. 次に、変数の値を定義するために**省略記号 (...) アイコン**を選択します。

   ![変数値を選択](../../../../../translated_images/7.3_22_SelectVariable.f16319e644afc97d24a8cddaf64a7df9fcc52acd7e284b21f20b685a6e53887a.ja.png)

1. PowerFx式を使用して、変数値を**Get items**レスポンスで返される`value`プロパティとして設定し、変数の[スコープ](https://learn.microsoft.com/microsoft-copilot-studio/advanced-power-fx?WT.mc_id=power-172618-ebenitez)をグローバルにするために`Global`のプレフィックスを追加します。

   **挿入**を選択し、トピックを**保存**します。

   ![変数値のPower Fx式](../../../../../translated_images/7.3_23_PowerFxFormula.f860daa2c8423021926f0697177279ede3d8d443714d471a77e655c3c42edb07.ja.png)

1. 次に、エージェントの指示を更新する必要があります。**概要**タブを選択し、**編集**を選択します。

   ![指示を編集](../../../../../translated_images/7.3_24_EditInstructions.ce65a6cbcd74792885230af1da432fbb4079fd8b0f5af24ab840453a900b67a8.ja.png)

1. 指示に新しい行を追加し、以下をコピーして貼り付けます。

    ```text
    - Help find available devices and give full details using [Available devices]. Always extract the VarDeviceType from the inputs. After giving device details, ask the user if they want to request a device from the list of available devices.
    ```

   この指示は、生成AIが**Available devices**トリガーを呼び出して、**Devices** SharePointリストから利用可能なデバイスのリストを表示するようにガイドします。角括弧内のトピックプレースホルダー全体を選択します。

   ![指示を追加](../../../../../translated_images/7.3_25_AddInstructions.1e83853476fed3c8b1c43e657bd1c1351108702288a8f688d8543fbf1c2946fb.ja.png)

1. スラッシュ文字`/`を入力すると、トピックのリストが表示されます。**Available devices**トピックを選択します。

   ![トリガーを参照](../../../../../translated_images/7.3_26_SelectAvailableDevicesTopic.1a1beaa256f5417153b7bc55de848b89778f666c213b3a3935444526ab881f0b.ja.png)

1. 更新された指示を**保存**します。

   ![指示を保存](../../../../../translated_images/7.3_27_SaveUpdatedInstructions.39908bb60990be971039bf392088fd0ecfa148c4496a6ad7413e1267b9091623.ja.png)

1. 更新されたエージェントをテストします。右上の**テスト**を選択してテストペインを表示し、テストペインを**更新**します。エージェントに以下のメッセージを入力します。

    ```text
    I need a laptop
    ```

   ![テスト](../../../../../translated_images/7.3_28_Test.a273496de273bf3bebb9ac1504c1cedd8947c250ccf8454cf38b2effbdf66f71.ja.png)

1. エージェントが進む前に、ユーザーは接続が使用可能であることを確認する必要があります。**許可**を選択します。

   ![許可を選択](../../../../../translated_images/7.3_29_SelectAllow.9f508c4001270252924d889792ecf0cc2a984954b903bb00f7ce6b2dc43d08e3.ja.png)

1. エージェントは、Power Fx式を使用してデバイスタイプが「laptop」でステータスが「available」であるデバイスのフィルタリングされたリストを取得するSharePointツールを実行します。箇条書き形式でフォーマットされたレスポンスがユーザーに返されます。

   ![テストのレスポンス](../../../../../translated_images/7.3_30_TestResponse.b60253568edc8b68d737a62960f4a3fa3620d2ba4658b05aa2503ad5fd763383.ja.png)

1. 最後に学ぶべきことは、エージェントの_接続を管理する_ページを表示して使用されている接続を確認する方法です。**省略記号 (...)** を選択し、**接続を管理**を選択します。

   ![接続を管理](../../../../../translated_images/7.3_31_ManageConnections.151932ec4f907e020b67c418cf591806da164c74f6b1d9b73c04d7374d9fc505.ja.png)

1. このページでは、エージェントが使用しているすべての接続を確認できます。現在、トピックに追加されたSharePointツールに関連付けられている1つの接続のみがリストされています。**Used By**列の**1 tool**を選択します。

   ![Used By](../../../../../translated_images/7.3_32_UsedBy.1e5ff032f1e02a565a0dafdde4f9436486ed3f012fcc23b824871a71b6de543e.ja.png)

1. ここでは、Get itemsアクションの詳細を確認できます。以前に入力した_使用説明_を覚えていますか？ここでその使用説明を見ることができます。**閉じる**を選択します。

   > これにより、使用されているアクションとその目的を確認できます。これにより、接続が整理されます 📁。

   ![使用説明](../../../../../translated_images/7.3_33_UsedByInformation.74a42aedb6dc906c678ff8b281a8706e1c0156ee7375111ed20e02d1a1dfd808.ja.png)

1. Copilot Studioのブラウザタブに戻り、テストペインを**更新**してテストをクリアします。

## ✅ ミッション完了

おめでとうございます！ 👏🏻 新しいトピックをゼロから追加する方法、Get items SharePointコネクタアクションを呼び出すツールを追加する方法、Power Fxを使用してレスポンスをフィルタリングし、ステータスが利用可能でデバイスタイプがラップトップであるデバイスのみを返す方法を学びました。 🙌🏻

これで**Lab 07 - 会話ノードを含む新しいトピックを追加する**の終了です。以下のリンクを選択して次のレッスンに進んでください。このラボのユースケースを次のレッスンのラボでさらに拡張します。

⏭️ [次のレッスン **適応型カードでユーザーインタラクションを強化する** に進む](../08-add-adaptive-card/README.md)

## 📚 実践的リソース

🔗 [システムトピックを使用する](https://learn.microsoft.com/microsoft-copilot-studio/authoring-system-topics?mc_id=power-172618-ebenitez)

🔗 [Microsoft Copilot Studioのトピック](https://learn.microsoft.com/microsoft-copilot-studio/guidance/topics-overview?WT.mc_id=power-172618-ebenitez)

🔗 [トピックトリガーを設定する](https://learn.microsoft.com/microsoft-copilot-studio/authoring-triggers?WT.mc_id=power-172618-ebenitez)

🔗 [エージェントトピックを定義する](https://learn.microsoft.com/microsoft-copilot-studio/guidance/defining-chatbot-topics?WT.mc_id=power-172618-ebenitez)

🔗 [Power Fxを使用して式を作成する](https://learn.microsoft.com/microsoft-copilot-studio/advanced-power-fx?WT.mc_id=power-172618-ebenitez)

📺 [自然言語を使用してトピックを作成する](https://aka.ms/ai-in-action/copilot-studio/ep6)

📺 [コネクタを使用してエージェントにアクションを追加する](https://aka.ms/ai-in-action/copilot-studio/ep4)

<img src="https://m365-visitor-stats.azurewebsites.net/agent-academy/recruit/07-add-new-topic-with-trigger" alt="Analytics" />

---

**免責事項**:  
この文書はAI翻訳サービス[Co-op Translator](https://github.com/Azure/co-op-translator)を使用して翻訳されています。正確性を追求しておりますが、自動翻訳には誤りや不正確な部分が含まれる可能性があります。元の言語で記載された文書を正式な情報源としてご参照ください。重要な情報については、専門の人間による翻訳を推奨します。この翻訳の使用に起因する誤解や誤解について、当社は責任を負いません。